<div class="popup-overlay" (click)="onOverlayClick($event)">
    <div class="popup-content" (click)="$event.stopPropagation()">
        <h2>Inserire informazioni</h2>

        <!-- Error Message -->
        @if(errorMessage()) {
        <div class="alert alert-error">
            {{ errorMessage() }}
        </div>
        }

        <!--Scegliere tuo IBAN-->
        <div class="input-group">

            <label for="popup-input">Scegli il tuo Iban:</label>
            <mat-form-field>
                <mat-label>Scegli il tuo IBAN</mat-label>
                <mat-select [(ngModel)]="selectedSenderIban">
                    @for (bankAccount of currentUser()?.bankAccounts; track bankAccount.id) {
                    @if (bankAccount.description && bankAccount.description !== '') {
                    <mat-option [value]="bankAccount">{{ bankAccount.description }} - {{ bankAccount.iban }}</mat-option>
                    } @else {
                    <mat-option [value]="bankAccount">{{ bankAccount.iban }}</mat-option>
                    }
                    } @empty {
                    <div class="empty-state">Nessun IBAN trovato</div>
                    }
                </mat-select>
            </mat-form-field>

            <!--Inserire IBAN del destinatario-->
            <p>
                <label for="popup-input">Inserisci IBAN del destinatario:</label>
                <input id="popup-input" type="text" [(ngModel)]="receiverIban" class="popup-input"
                    placeholder="IBAN del destinatario" (keydown.enter)="onConfirm()" (keydown.escape)="onCancel()" />
            </p>

            <!--Importo e Valuta-->
            <label for="popup-input">Inserisci l'importo da versare:</label>
            <div class="amount-currency-row">
                <mat-form-field class="amount-field">
                    <mat-label>Importo</mat-label>
                    <input matInput type="number" [(ngModel)]="amount" class="amount-right-align" min="0"
                        placeholder="0,00" />
                </mat-form-field>

                <mat-form-field class="currency-field">
                    <mat-label>Seleziona valuta</mat-label>
                    <mat-select [(ngModel)]="selectedCurrency">
                        @for (currency of currencies; track currency.code) {
                        <mat-option [value]="currency">{{ currency.name }} ({{ currency.symbol }})</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>
            <!--Causale-->

            <label for="popup-input">Causale:</label>
            <input id="popup-input" type="text" [(ngModel)]="currentValue" class="popup-input" placeholder="Causale"
                (keydown.enter)="onConfirm()" (keydown.escape)="onCancel()" />


        </div>

        <div class="button-group">
            <button type="button" (click)="onCancel()" class="btn btn-secondary">
                Annulla
            </button>

            <button type="button" (click)="onConfirm()" class="btn btn-primary" [disabled]="!isFormValid()">
                Manda bonifico
            </button>
        </div>
    </div>
</div>