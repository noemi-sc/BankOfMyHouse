<div class="investment">
  <header class="investment-header">
    <h1>I suoi investimenti</h1>
  </header>

  <!-- Button investimenti -->
  <mat-grid-list cols="1" rowHeight="100px">

    <mat-grid-tile> <button mat-button class="open-popup-btn" (click)="openInvestmentPopup() ">Crea nuovo
        investimento</button>
      @if (isInvestmentPopupOpen()) {
      <app-create-investment [initialValue]="inputValue()" (confirmed)="onInvestmentPopupConfirmed($event)"
        (cancelled)="onInvestmentPopupCancelled()" />
      }
    </mat-grid-tile>
  </mat-grid-list>

  <mat-grid-list cols="4" rowHeight="350px" class="investment-cards">
    <mat-grid-tile class="investment-card" colspan="3">
      <div class="graph-grid">
        <h2>I suoi inversitmenti</h2>
        graph
      </div>
    </mat-grid-tile>
    <mat-grid-tile class="investment-card" colspan="1">
      <div class="list-grid">
        <h2>Lista investimenti</h2>
        @for (investment of investments(); track investment.id) {
        <div class="investment-card">
          <h3>{{ investment.companyName || investment.company?.name }}</h3>
          <p class="amount">{{ investment.amount | currency:'EUR':'symbol':'1.2-2' }}</p>
          <p class="shares">Azioni: {{ investment.shares }}</p>
          <p class="creation-date">Creato il: {{ investment.createdAt | date:'short' }}</p>
        </div>
        } @empty {
        <div class="empty-state">Nessun investimento trovato</div>
        }
      </div>
    </mat-grid-tile>
  </mat-grid-list>

  <div class="investment-grid">
    <section class="transactions-section">
      <div class="transactions-container">
        <h2>Ditte da investire</h2>


      </div>
    </section>
  </div>

  <br>

</div>


<!-- OLD INVESTMENT - TO CANCEL-->

 <div class="investment-container">
  <!-- Connection Status -->
     <div class="status-indicator" [class]="connectionStatusClass()">
        <strong>Status:</strong> {{ signalrService.connectionStatus() }}
    </div> 

<!-- Controls -->
     <div class="controls">
        <button (click)="reconnect()" [disabled]="signalrService.connectionStatus() === 'connecting'">
            Reconnect
        </button>
        <button (click)="clearChart()">Clear Chart</button>
        <button>Add Test Data</button>  <!-- ðŸ”§ FIXED: Added click handler-->
     </div> 

<!-- Data Info -->
    <div class="data-info">
        <strong>Data points:</strong> {{ dataPointCount() }}
        @if (lastUpdate(); as lastUpdate) {
        <span> | <strong>Last update:</strong> {{ lastUpdate.toLocaleTimeString() }}</span>
        }
        @if (latestPrice(); as price) {
        <span> | <strong>Latest price:</strong> ${{ price.toFixed(4) }}</span>
        }
    </div> 

<!-- Chart Container -->
   <div class="chart-container">
         @if (dataPointCount() > 0) {
        <div class="chart-wrapper">
            <canvas baseChart [data]="chartConfiguration()" [options]="chartOptions" [type]="chartType" #chartCanvas> 
<!-- ðŸ”§ ADDED: Template reference for debugging -->
            </canvas>
        </div>
        } @else {
        <div class="no-data-placeholder">
            <h3>No Data Available</h3>
            <p>Waiting for real-time stock price data...</p>
 <button class="test-btn">Add Test Data to See Chart</button>  <!-- ðŸ”§ FIXED: Added click handler -->
         </div>
        }
    </div>  

<!-- Debug Info -->
    <div class="debug-section">
        <details>
            <summary>Debug Information</summary>
            <pre>{{ debugInfo() | json }}</pre>
        </details>
    </div>
</div> 